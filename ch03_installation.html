
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>3 Installation and Usage &#8212; SIFRA v0.2.0 docs</title>
    <link rel="stylesheet" href="_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4 Simulation Setup" href="ch04_simsetup.html" />
    <link rel="prev" title="2 Model Concepts" href="ch02_concept.html" />
  
   

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ch04_simsetup.html" title="4 Simulation Setup"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ch02_concept.html" title="2 Model Concepts"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SIFRA</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
        <a href="
    index.html" class="text-logo">SIFRA</a>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ch01_intro.html">1 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch02_concept.html">2 Model Concepts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3 Installation and Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">3.1 Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aws-and-docker">3.2 AWS and Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-a-development-environment-with-anaconda">3.3 Setting Up a Development Environment with Anaconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-core-sifra-code">3.4 Running the Core SIFRA Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-code-tests">3.5 Running Code Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ch04_simsetup.html">4 Simulation Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch05_fragility_attribution.html">5 Component Fragility Attribution</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="reportglossary.html">Glossary</a></li>
</ul>

    
  </div>
</div>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="index.html">Docs</a></li>
              
              <li>3 Installation and Usage</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="installation-and-usage">
<h1>3 Installation and Usage<a class="headerlink" href="#installation-and-usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="requirements">
<span id="system-requirements"></span><h2>3.1 Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p><strong>SIFRA</strong> is built in Python 2.7. Python hardware requirements are fairly
minimal. Most modern systems based on x86 architecture should be able to run
this software.</p>
<p>SIFRA has been tested on the following operating systems:</p>
<ul class="simple">
<li>OS X 10.11</li>
<li>Ubuntu 14.04 (64 bit)</li>
<li>Windows 10</li>
</ul>
<p>The code should work on most other versions of these operating systems,
though the environment setup process will likely have some differences.
Windows systems that are not based on the NT-platform are not supported. This
restriction is due to the fact that from version 2.6 onwards Python has not
supported non-NT Windows platforms.</p>
<p>You will need to install <cite>Graphviz</cite>, which is used by
<cite>networkx</cite> and <cite>pygraphviz</cite> packages to draw the system diagram.
Please visit: <a class="reference external" href="http://www.graphviz.org/">http://www.graphviz.org/</a> and download the appropriate
version for your operating system. Follow the posted download instructions
carefully. After installation you may need to update the PATH variable
with the location of the Graphviz binaries.</p>
<p>For windows systems you will need to install Microsoft Visual C++ Compiler
for Python 2.7: <a class="reference external" href="http://aka.ms/vcpython27">http://aka.ms/vcpython27</a></p>
</div>
<div class="section" id="aws-and-docker">
<span id="setup-dev-environ"></span><h2>3.2 AWS and Docker<a class="headerlink" href="#aws-and-docker" title="Permalink to this headline">¶</a></h2>
<p>The development of the Web interface to provide the ability to create
component types and models led to the usage of Docker and AWS. Docker
creates containers that provide independence of platforms when developing
applications and services. So Docker removes the requirement for Conda
to organise the Python libraries. The downside of using docker in our
environment (GA Sysmonston) is that network security makes running Docker
difficult. So development environments are easier to create and use on AWS.
Use of AWS for Web applications is the current direction for GA.</p>
<div class="section" id="installation-of-sifra-on-aws-with-docker">
<h3>3.2.1 Installation of SIFRA on AWS with Docker<a class="headerlink" href="#installation-of-sifra-on-aws-with-docker" title="Permalink to this headline">¶</a></h3>
<p>This requires building an AWS instance and then building the environments
using Docker.</p>
<p><strong>Create AWS Instance using Packer</strong>:
We’re we come from, if we don’t have a laptop handy, we like to use AWS for
provisioning dev machines. A basic dev box can be setup using
<a class="reference external" href="https://www.packer.io/intro/">Packer</a>, by running:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ packer build build.json
</pre></div>
</div>
<p>in the current directory.</p>
<p><strong>Create AWS Instance using bash script</strong>:</p>
<p>The top level directory of SIFRA has the script <code class="docutils literal"><span class="pre">create-instance.sh</span></code>
The script requires the <a class="reference external" href="https://aws.amazon.com/cli/">aws command line interface</a>
to be installed on the machine. It also requires access to AWS account credentials.</p>
<p>The script is run as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ create-instance.sh
</pre></div>
</div>
<p>Both of these commands will use the build_sifra_box.sh to install Linux updates
and the docker components that will be required.</p>
<p>It then clones the SIFRA github repository, from the master branch. Docker is
then used to build the SIFRA environment.</p>
</div>
<div class="section" id="using-docker">
<h3>3.2.2 Using Docker<a class="headerlink" href="#using-docker" title="Permalink to this headline">¶</a></h3>
<p>If you have Docker installed, you can build a container for working with
sifra by running the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker build -t sifra .
</pre></div>
</div>
<p>The primary advantage of working with docker is that you do not have to worry
about setting up the python environment, which is done when building the
container and isolated from your own environment.</p>
<p>To run an interactive container you can use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker run -it -v &quot;$(pwd):/sifra&quot; --name sifra s
</pre></div>
</div>
<p>This will give you a terminal inside the container in which you can execute
commands. Inside the container you can find the current directory mapped at
<cite>/sifra</cite>. You can modify files either within the container or the host and the
changes will be available in both.</p>
<p>Alternatively, you might want a container running in the background which you
can execute commands at using
<a class="reference external" href="https://docs.docker.com/engine/reference/commandline/exec/">docker exec</a>. In
this case you would start the container with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker run -id -v &quot;$(pwd):/sifra&quot; --name sifra sifra
</pre></div>
</div>
<p>One could then, for example, run the unit tests for the modelling package with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker exec sifra python -m unittest sifra.modelling.test_structural
</pre></div>
</div>
<p>In any case, once you are done you should destroy the container with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker kill sifra
$ docker rm sifra
</pre></div>
</div>
<p>or, if your too lazy to type two lines, use this command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker rm -f sifra
</pre></div>
</div>
<p>Several other containers are provided to help with development. These are
defined in the other <cite>Dockerfiles</cite> in the present directory, and are:</p>
<ul>
<li><p class="first"><em>Dockerfile-api</em>: Provides a web API which is used for parameterising
model components (at this stage just response functions) and serialising them.
This is presently (at Feb 2017) a prototype and provides only a small subset
of what we hope for.</p>
</li>
<li><p class="first"><em>Dockerfile-gui-dev</em>: Provides an <a class="reference external" href="https://angular.io/">Angular2</a> application for
defining model components built on top of the API mentioned above. The application
is hosted using Angular’s development server and can be accessed on <em>localhost:4200</em>.</p>
</li>
<li><p class="first"><em>Dockerfile-gui-prod</em>: For deploying the web application in production. This
does a production build of the Angular project and hosts it using
<a class="reference external" href="https://www.busybox.net/">busybox</a>. The app is still exposed on port 4200, so
to host it at port 80 one would start it with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker build -t sifra-gui -f Dockerfile-gui-prod .
</pre></div>
</div>
</li>
</ul>
<p>and start it with (for example):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker run -d -p 80:4200 --restart always sifra-gui-prod
</pre></div>
</div>
</div>
<div class="section" id="docker-compose">
<h3>3.2.3 Docker Compose<a class="headerlink" href="#docker-compose" title="Permalink to this headline">¶</a></h3>
<p>By far the easiest way to run the system for development is with
<a class="reference external" href="https://docs.docker.com/compose/">docker-compose</a>, which can be done with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker-compose up
</pre></div>
</div>
<p>Assuming that you start the system this way in the current folder, you can:</p>
<ul>
<li><p class="first">attach to the sifa image to run models and tests with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker attach sifra_sifra_1
</pre></div>
</div>
</li>
<li><p class="first">access the GUI for defining fragility functions at <em>http://localhost:4200</em>, and</p>
</li>
<li><p class="first">access the web API at <em>http://localhost:5000</em>.</p>
</li>
</ul>
<p>Then both the API and GUI will stay in sync with your code.</p>
<p>You can tear the system down (destroying the containers) with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ docker-compose down
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-up-a-development-environment-with-anaconda">
<h2>3.3 Setting Up a Development Environment with Anaconda<a class="headerlink" href="#setting-up-a-development-environment-with-anaconda" title="Permalink to this headline">¶</a></h2>
<p>We recommend using <code class="docutils literal"><span class="pre">conda</span></code> for managing virtual environments and
packages required for running <code class="docutils literal"><span class="pre">sifra</span></code>.</p>
<p>For the sake of simplicity, we recommend using <code class="docutils literal"><span class="pre">Anaconda</span></code>. It is a
free Python distribution, and comes with the <code class="docutils literal"><span class="pre">conda</span></code> tool which is
both a package manager and environment manager. Instructions for
installing <code class="docutils literal"><span class="pre">Anaconda</span></code> are
<a class="reference external" href="http://docs.continuum.io/anaconda/install">here</a>.</p>
<p>Some packages we need are not hosted in the main <code class="docutils literal"><span class="pre">conda</span></code> package
repository. In such cases we will host them in our own user channel.
We suggest adding the following channels to the default:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ conda config --add channels https://conda.anaconda.org/anaconda
$ conda config --add channels https://conda.anaconda.org/marufr
</pre></div>
</div>
<p>Run the following command to confirm the additional channels have
been added:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ conda config --get channels
</pre></div>
</div>
<p><strong>For OS X and Linux-64 systems</strong>: It should be possible to set up a full run
environment solely through the *.yml environment specification file. For OS X
run the following commands:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ conda env create -f environment_osx.yml
$ source activate sifra_env
</pre></div>
</div>
<p>For Linux-64 systems, the commands are identical, you will just need to use
the environment specification file for Linux.</p>
<p><strong>For Windows systems</strong>, a similar process needs to be followed, with some
exceptions. First run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ conda env create -f environment_win64.yml
$ activate sifra_env
</pre></div>
</div>
<p>This will install most requirements except for <code class="docutils literal"><span class="pre">igraph</span></code> and <code class="docutils literal"><span class="pre">pygraphviz</span></code>.
Compiling these packages under windows can be very challenging. The simplest
and most reliable option is to download the the appropriate binary
distribution in the form of <cite>wheels</cite> from
<a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Christoph Gohlke’s unofficial page of Windows binaries</a>.</p>
<p>Download the appropriate <cite>wheels</cite> (*.whl files) of the following packages
for your Windows platform (32 or 64 bit):</p>
<ul class="simple">
<li><a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#python-igraph">python-igraph</a></li>
<li><a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#pygraphviz">pygraphviz</a>.</li>
</ul>
<p>Install the downloaded <cite>wheels</cite> (*.whl files) with pip:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">pkg_name</span><span class="o">&gt;.</span><span class="n">whl</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-core-sifra-code">
<span id="running-sifra"></span><h2>3.4 Running the Core SIFRA Code<a class="headerlink" href="#running-the-core-sifra-code" title="Permalink to this headline">¶</a></h2>
<p>For the purposes of discussion, it is assumed that the name of the
configuration file is <code class="docutils literal"><span class="pre">config_x.conf</span></code>, and it is located in the
directory <code class="docutils literal"><span class="pre">/Users/user_x/sifra/simulation_setup/</span></code>.</p>
<p>The software can be run from the command line using these simple steps:</p>
<ol class="arabic">
<li><p class="first">Open a command terminal</p>
</li>
<li><p class="first">Change to the directory that has the <code class="docutils literal"><span class="pre">sifra</span></code> code. If the code is
in the directorty <code class="docutils literal"><span class="pre">/Users/user_x/sifra</span></code>, then run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">sifra</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p class="first">Run the primary fragility characterisation module from the command
line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sifra</span> <span class="n">simulation_setup</span><span class="o">/</span><span class="n">config_x</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
</ol>
<p>The post-processing tools are run as simple python scripts. It should be
noted, that the post-processing tools depend on the outputs produced by a
full simulation run that characterises the system fragility. Therefore,
thea full run of the SIFRA needs to be conducted on the system model of
interest prior to running the tools for model fitting and scenario and
restoration analysis tools. They are simply run as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">sifra</span><span class="o">/</span><span class="n">sifra</span><span class="o">/</span>
<span class="n">python</span> <span class="n">fit_model</span><span class="o">.</span><span class="n">py</span> <span class="o">../</span><span class="n">simulation_setup</span><span class="o">/</span><span class="n">config_x</span><span class="o">.</span><span class="n">conf</span>
<span class="n">python</span> <span class="n">scenario_loss_analysis</span><span class="o">.</span><span class="n">py</span> <span class="o">../</span><span class="n">simulation_setup</span><span class="o">/</span><span class="n">config_x</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</div>
<div class="section" id="running-code-tests">
<h2>3.5 Running Code Tests<a class="headerlink" href="#running-code-tests" title="Permalink to this headline">¶</a></h2>
<p>To run tests use either <code class="docutils literal"><span class="pre">nose</span></code> or <code class="docutils literal"><span class="pre">unittest</span></code>.
Example (from the first level ‘sifra’ directory):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cd sifra   # and not cd sifra/sifra
$ python -m unittest discover tests
</pre></div>
</div>
<p>or, simply run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ nosetest
</pre></div>
</div>
<p>If you are using docker as described above, you can do this within the sifra
container.</p>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="ch02_concept.html" title="previous chapter (use the left arrow)">2 Model Concepts</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="ch04_simsetup.html" title="next chapter (use the right arrow)">4 Simulation Setup</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ch04_simsetup.html" title="4 Simulation Setup"
             >next</a> |</li>
        <li class="right" >
          <a href="ch02_concept.html" title="2 Model Concepts"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SIFRA</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2017, Geoscience Australia. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>